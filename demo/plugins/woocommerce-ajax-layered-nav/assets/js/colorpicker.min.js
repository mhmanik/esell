!function(c){var t,o,a,r,i,n,l,d,s,p,e,u,f,h,v,m,g,k,b,_=(o={eventName:"click",onShow:function(){},onBeforeShow:function(){},onHide:function(){},onChange:function(){},onSubmit:function(){},color:"ff0000",livePreview:!0,flat:!(t=65)},a=function(o){var e,t=c(this).parent().parent();0<this.parentNode.className.indexOf("_hex")?t.data("colorpicker").color=e=m(v(this.value)):0<this.parentNode.className.indexOf("_hsb")?t.data("colorpicker").color=e=f({h:parseInt(t.data("colorpicker").fields.eq(4).val(),10),s:parseInt(t.data("colorpicker").fields.eq(5).val(),10),b:parseInt(t.data("colorpicker").fields.eq(6).val(),10)}):t.data("colorpicker").color=e=g(h({r:parseInt(t.data("colorpicker").fields.eq(1).val(),10),g:parseInt(t.data("colorpicker").fields.eq(2).val(),10),b:parseInt(t.data("colorpicker").fields.eq(3).val(),10)})),o&&(x(e,t.get(0)),y(e,t.get(0)),w(e,t.get(0))),C(e,t.get(0)),M(e,t.get(0)),q(e,t.get(0)),t.data("colorpicker").onChange.apply(t,[e,b(e),k(e)])},r=function(o){return o.data.field.val(Math.max(0,Math.min(o.data.max,parseInt(o.data.val+o.pageY-o.data.y,10)))),o.data.preview&&a.apply(o.data.field.get(0),[!0]),!1},i=function(o){return a.apply(o.data.field.get(0),[!0]),o.data.el.removeClass("colorpicker_slider").find("input").focus(),c(document).off("mouseup",i),c(document).off("mousemove",r),!1},n=function(o){return a.apply(o.data.cal.data("colorpicker").fields.eq(4).val(parseInt(360*(150-Math.max(0,Math.min(150,o.pageY-o.data.y)))/150,10)).get(0),[o.data.preview]),!1},l=function(o){return x(o.data.cal.data("colorpicker").color,o.data.cal.get(0)),y(o.data.cal.data("colorpicker").color,o.data.cal.get(0)),c(document).off("mouseup",l),c(document).off("mousemove",n),!1},d=function(o){return a.apply(o.data.cal.data("colorpicker").fields.eq(6).val(parseInt(100*(150-Math.max(0,Math.min(150,o.pageY-o.data.pos.top)))/150,10)).end().eq(5).val(parseInt(100*Math.max(0,Math.min(150,o.pageX-o.data.pos.left))/150,10)).get(0),[o.data.preview]),!1},s=function(o){return x(o.data.cal.data("colorpicker").color,o.data.cal.get(0)),y(o.data.cal.data("colorpicker").color,o.data.cal.get(0)),c(document).off("mouseup",s),c(document).off("mousemove",d),!1},p=function(o){e(o.data.cal.get(0),o.target,o.data.cal.get(0))||(0!=o.data.cal.data("colorpicker").onHide.apply(this,[o.data.cal.get(0)])&&o.data.cal.hide(),c(document).off("mousedown",p))},e=function(o,e,t){if(o==e)return!0;if(o.contains)return o.contains(e);if(o.compareDocumentPosition)return!!(16&o.compareDocumentPosition(e));for(var r=e.parentNode;r&&r!=t;){if(r==o)return!0;r=r.parentNode}return!1},u=function(){var o="CSS1Compat"==document.compatMode;return{l:window.pageXOffset||(o?document.documentElement.scrollLeft:document.body.scrollLeft),t:window.pageYOffset||(o?document.documentElement.scrollTop:document.body.scrollTop),w:window.innerWidth||(o?document.documentElement.clientWidth:document.body.clientWidth),h:window.innerHeight||(o?document.documentElement.clientHeight:document.body.clientHeight)}},f=function(o){return{h:Math.min(360,Math.max(0,o.h)),s:Math.min(100,Math.max(0,o.s)),b:Math.min(100,Math.max(0,o.b))}},h=function(o){return{r:Math.min(255,Math.max(0,o.r)),g:Math.min(255,Math.max(0,o.g)),b:Math.min(255,Math.max(0,o.b))}},v=function(o){var e=6-o.length;if(0<e){for(var t=[],r=0;r<e;r++)t.push("0");t.push(o),o=t.join("")}return o},m=function(o){return g((e=o,{r:(e=parseInt(-1<e.indexOf("#")?e.substring(1):e,16))>>16,g:(65280&e)>>8,b:255&e}));var e},g=function(o){var e={h:0,s:0,b:0},t=Math.min(o.r,o.g,o.b),r=Math.max(o.r,o.g,o.b),a=r-t;return e.b=r,e.s=0!=r?255*a/r:0,0!=e.s?o.r==r?e.h=(o.g-o.b)/a:o.g==r?e.h=2+(o.b-o.r)/a:e.h=4+(o.r-o.g)/a:e.h=-1,e.h*=60,e.h<0&&(e.h+=360),e.s*=100/255,e.b*=100/255,e},k=function(o){var e={},t=Math.round(o.h),r=Math.round(255*o.s/100),a=Math.round(255*o.b/100);if(0==r)e.r=e.g=e.b=a;else{var i=a,c=(255-r)*a/255,n=t%60*(i-c)/60;360==t&&(t=0),t<60?(e.r=i,e.b=c,e.g=c+n):t<120?(e.g=i,e.b=c,e.r=i-n):t<180?(e.g=i,e.r=c,e.b=c+n):t<240?(e.b=i,e.r=c,e.g=i-n):t<300?(e.b=i,e.g=c,e.r=c+n):t<360?(e.r=i,e.g=c,e.b=i-n):(e.r=0,e.g=0,e.b=0)}return{r:Math.round(e.r),g:Math.round(e.g),b:Math.round(e.b)}},b=function(o){return e=k(o),t=[e.r.toString(16),e.g.toString(16),e.b.toString(16)],c.each(t,function(o,e){1==e.length&&(t[o]="0"+e)}),t.join("");var e,t},{init:function(r){if("string"==typeof(r=c.extend({},o,r||{})).color)r.color=m(r.color);else if(null!=r.color.r&&null!=r.color.g&&null!=r.color.b)r.color=g(r.color);else{if(null==r.color.h||null==r.color.s||null==r.color.b)return this;r.color=f(r.color)}return this.each(function(){if(!c(this).data("colorpickerId")){var o=c.extend({},r);o.origColor=r.color;var e="collorpicker_"+parseInt(1e3*Math.random());c(this).data("colorpickerId",e);var t=c('<div class="colorpicker"><div class="colorpicker_color"><div><div></div></div></div><div class="colorpicker_hue"><div></div></div><div class="colorpicker_new_color"></div><div class="colorpicker_current_color"></div><div class="colorpicker_hex"><input type="text" maxlength="6" size="6" /></div><div class="colorpicker_rgb_r colorpicker_field"><input type="text" maxlength="3" size="3" /><span></span></div><div class="colorpicker_rgb_g colorpicker_field"><input type="text" maxlength="3" size="3" /><span></span></div><div class="colorpicker_rgb_b colorpicker_field"><input type="text" maxlength="3" size="3" /><span></span></div><div class="colorpicker_hsb_h colorpicker_field"><input type="text" maxlength="3" size="3" /><span></span></div><div class="colorpicker_hsb_s colorpicker_field"><input type="text" maxlength="3" size="3" /><span></span></div><div class="colorpicker_hsb_b colorpicker_field"><input type="text" maxlength="3" size="3" /><span></span></div><div class="colorpicker_submit"></div></div>').attr("id",e);o.flat?t.appendTo(this).show():t.appendTo(document.body),o.fields=t.find("input").on("keyup",P).on("change",a).on("blur",N).on("focus",S),t.find("span").on("mousedown",H).end().find(">div.colorpicker_current_color").on("click",W),o.selector=t.find("div.colorpicker_color").on("mousedown",z),o.selectorIndic=o.selector.find("div div"),o.el=this,o.hue=t.find("div.colorpicker_hue div"),t.find("div.colorpicker_hue").on("mousedown",O),o.newColor=t.find("div.colorpicker_new_color"),o.currentColor=t.find("div.colorpicker_current_color"),t.data("colorpicker",o),t.find("div.colorpicker_submit").on("mouseenter",Y).on("mouseleave",E).on("click",T),x(o.color,t.get(0)),w(o.color,t.get(0)),y(o.color,t.get(0)),M(o.color,t.get(0)),C(o.color,t.get(0)),I(o.color,t.get(0)),q(o.color,t.get(0)),o.flat?t.css({position:"relative",display:"block"}):c(this).on(o.eventName,j)}})},showPicker:function(){return this.each(function(){c(this).data("colorpickerId")&&j.apply(this)})},hidePicker:function(){return this.each(function(){c(this).data("colorpickerId")&&c("#"+c(this).data("colorpickerId")).hide()})},setColor:function(e){if("string"==typeof e)e=m(e);else if(null!=e.r&&null!=e.g&&null!=e.b)e=g(e);else{if(null==e.h||null==e.s||null==e.b)return this;e=f(e)}return this.each(function(){if(c(this).data("colorpickerId")){var o=c("#"+c(this).data("colorpickerId"));o.data("colorpicker").color=e,o.data("colorpicker").origColor=e,x(e,o.get(0)),w(e,o.get(0)),y(e,o.get(0)),M(e,o.get(0)),C(e,o.get(0)),I(e,o.get(0)),q(e,o.get(0))}})}});function x(o,e){var t=k(o);c(e).data("colorpicker").fields.eq(1).val(t.r).end().eq(2).val(t.g).end().eq(3).val(t.b).end()}function w(o,e){c(e).data("colorpicker").fields.eq(4).val(o.h).end().eq(5).val(o.s).end().eq(6).val(o.b).end()}function y(o,e){c(e).data("colorpicker").fields.eq(0).val(b(o)).end()}function C(o,e){c(e).data("colorpicker").selector.css("backgroundColor","#"+b({h:o.h,s:100,b:100})),c(e).data("colorpicker").selectorIndic.css({left:parseInt(150*o.s/100,10),top:parseInt(150*(100-o.b)/100,10)})}function M(o,e){c(e).data("colorpicker").hue.css("top",parseInt(150-150*o.h/360,10))}function I(o,e){c(e).data("colorpicker").currentColor.css("backgroundColor","#"+b(o))}function q(o,e){c(e).data("colorpicker").newColor.css("backgroundColor","#"+b(o))}function P(o){var e=o.charCode||o.keyCode||-1;if(t<e&&e<=90||32==e)return!1;!0===c(this).parent().parent().data("colorpicker").livePreview&&a.apply(this)}function N(o){c(this).parent().parent().data("colorpicker").fields.parent().removeClass("colorpicker_focus")}function S(){t=0<this.parentNode.className.indexOf("_hex")?70:65,c(this).parent().parent().data("colorpicker").fields.parent().removeClass("colorpicker_focus"),c(this).parent().addClass("colorpicker_focus")}function H(o){var e=c(this).parent().find("input").focus(),t={el:c(this).parent().addClass("colorpicker_slider"),max:0<this.parentNode.className.indexOf("_hsb_h")?360:0<this.parentNode.className.indexOf("_hsb")?100:255,y:o.pageY,field:e,val:parseInt(e.val(),10),preview:c(this).parent().parent().data("colorpicker").livePreview};c(document).on("mouseup",t,i),c(document).on("mousemove",t,r)}function O(o){var e={cal:c(this).parent(),y:c(this).offset().top};e.preview=e.cal.data("colorpicker").livePreview,c(document).bind("mouseup",e,l),c(document).on("mousemove",e,n)}function z(o){var e={cal:c(this).parent(),pos:c(this).offset()};e.preview=e.cal.data("colorpicker").livePreview,c(document).on("mouseup",e,s),c(document).on("mousemove",e,d)}function Y(o){c(this).addClass("colorpicker_focus")}function E(o){c(this).removeClass("colorpicker_focus")}function T(o){var e=c(this).parent(),t=e.data("colorpicker").color;e.data("colorpicker").origColor=t,I(t,e.get(0)),e.data("colorpicker").onSubmit(t,b(t),k(t),e.data("colorpicker").el)}function j(o){var e=c("#"+c(this).data("colorpickerId"));e.data("colorpicker").onBeforeShow.apply(this,[e.get(0)]);var t=c(this).offset(),r=u(),a=t.top+this.offsetHeight,i=t.left;return a+176>r.t+r.h&&(a-=this.offsetHeight+176),i+356>r.l+r.w&&(i-=356),e.css({left:i+"px",top:a+"px"}),0!=e.data("colorpicker").onShow.apply(this,[e.get(0)])&&e.show(),c(document).on("mousedown",{cal:e},p),!1}function W(){var o=c(this).parent(),e=o.data("colorpicker").origColor;o.data("colorpicker").color=e,x(e,o.get(0)),y(e,o.get(0)),w(e,o.get(0)),C(e,o.get(0)),M(e,o.get(0)),q(e,o.get(0))}c.fn.extend({ColorPicker:_.init,ColorPickerHide:_.hidePicker,ColorPickerShow:_.showPicker,ColorPickerSetColor:_.setColor})}(jQuery);
